import{a as H,R as T,j as e,m as W,C as _,b as u,L as V,B as S,c as $,M as k,d as c,I as Y,e as q,f as P,F as D,h as z,r as g,u as J,g as K,i as E,k as Q,l as X,y as N,n as F}from"./index-BR7e0FAz.js";import{L as n}from"./ListGroup-CPytsWHT.js";const Z=H.injectEndpoints({endpoints:s=>({createReview:s.mutation({query:({productId:i,review:l})=>({url:`${T}/product/${i}`,method:"POST",body:l}),invalidatesTags:(i,l,{productId:d})=>[{type:"Reviews",id:d}]}),getProductReviews:s.query({query:i=>({url:`${T}/product/${i}`,method:"GET"}),providesTags:(i,l,d)=>[{type:"Reviews",id:d}]})})}),{useCreateReviewMutation:ee,useGetProductReviewsQuery:se}=Z,te=({product:s,qty:i,setQty:l,addToCartHandler:d,reviews:x,loadingReviews:v,userInfo:p,rating:h,setRating:w,comment:j,handleCommentChange:y,commentSubmitHandler:R,loadingReviewCreate:b,errorReviewCreate:L,productLoading:C,productLoadingError:r,showMessage:I})=>e.jsx(W.div,{initial:{x:-200,opacity:0},animate:{x:0,opacity:1},transition:{duration:.5,ease:"easeOut"},children:e.jsxs(_,{children:[e.jsx(u,{className:"mb-3",children:e.jsx(V,{to:"/",className:"text-center text-md-start",children:e.jsx(S,{variant:"secondary",children:"Go Back"})})}),C?e.jsx($,{}):r?e.jsx(k,{variant:"danger",children:r?.data?.message||r.error}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[e.jsx(c,{xs:10,md:5,className:"mx-auto",children:e.jsx(Y,{src:s?.image,alt:s?.name,fluid:!0,className:"shadow-lg",rounded:!0})}),e.jsx(c,{xs:10,md:4,className:"mx-auto mt-1",children:e.jsx(q,{className:"shadow-sm",children:e.jsxs(n,{variant:"flush",className:"rounded mx-3",children:[e.jsx(n.Item,{className:"my-2 p-3 rounded",children:e.jsx("h3",{children:s?.name})}),e.jsx(n.Item,{className:"my-2 p-3 rounded",children:e.jsx(P,{value:s?.rating??null,text:`${s?.numReviews} reviews`})}),e.jsx(n.Item,{className:"my-2 p-3 rounded fs-5",children:e.jsxs("strong",{children:["Price: ",s?.price,"$"]})}),e.jsxs(n.Item,{className:"my-2 p-3 rounded",children:[e.jsx("strong",{children:"Description: "}),e.jsx("i",{children:s?.description})]})]})})}),e.jsxs(c,{xs:10,md:3,className:"mx-auto mt-1",children:[e.jsx(q,{className:"shadow-sm",children:e.jsxs(n,{variant:"flush",children:[e.jsx(n.Item,{children:e.jsxs(u,{children:[e.jsx(c,{children:e.jsx("strong",{children:"Price:"})}),e.jsx(c,{children:e.jsxs("strong",{children:[s?.price,"$"]})})]})}),e.jsx(n.Item,{children:e.jsxs(u,{children:[e.jsx(c,{children:e.jsx("strong",{children:"Status:"})}),e.jsx(c,{children:e.jsx("strong",{children:s&&s?.countInStock>0?"In Stock":"Out Of Stock"})})]})}),s&&s.countInStock>0&&e.jsx(n.Item,{children:e.jsxs(u,{children:[e.jsx(c,{style:{display:"flex",alignItems:"center"},children:e.jsx("strong",{children:"Quantity:"})}),e.jsx(c,{children:e.jsx(D.Select,{as:"select",value:i,onChange:t=>l(Number(t.target.value)),children:[...Array(s?.countInStock).keys()].map(t=>e.jsxs("option",{value:t+1,children:[" ",t+1," "]},t+1))})})]})}),e.jsx(n.Item,{className:"text-center",children:e.jsx(S,{className:"my-2",variant:"secondary",disabled:s?.countInStock===0,onClick:d,children:"Add to Cart"})})]})}),I&&e.jsx(k,{variant:"danger",children:"You reached maximum product count in stock"})]})]}),e.jsx(u,{children:e.jsx(c,{className:"mt-5",md:6,children:v?e.jsx($,{}):x?.reviews?.length===0?e.jsx(k,{children:"No Reviews"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reviews",children:[e.jsx(D.Control,{as:"textarea",rows:3,value:j,maxLength:500,className:"text-area placeholder-secondary",placeholder:"Write your comment...",type:"text",onChange:y}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center p-1",children:[e.jsx(P,{value:h,text:`Rating: ${h}`,onChange:t=>{w(t)}})," ",e.jsx(S,{className:"mt-0 mb-1 mx-2",variant:"primary",onClick:t=>R(t),children:"Comment"})]})]}),x?.reviews.length!==0?e.jsx("h3",{children:"User Reviews"}):null,e.jsx(n,{children:x?.reviews?.map((t,m)=>e.jsxs(n.Item,{className:"review-item mb-2 rounded shadow-sm",children:[e.jsxs("p",{className:"list-group-item-text",children:[e.jsx("strong",{children:z(t.user.name)}),e.jsx(P,{value:t.rating})]}),e.jsx("p",{className:"mb-2",children:t.comment}),e.jsx("p",{className:"text-muted mb-1 mt-0",children:t.createdAt.split("T")[0]})]},m))})]})})})]})]})}),ne=()=>{const[s,i]=g.useState(0),[l,d]=g.useState(""),[x,v]=g.useState(1),[p,h]=g.useState(!1),w=J(),j=K(),{userInfo:y}=E(a=>a.auth),{cartItems:R}=E(a=>a.cart),[b,{isLoading:L,error:C}]=ee(),{id:r}=Q(),{data:I,isLoading:t}=se(r,{skip:!r}),{data:m,isLoading:G,error:M}=X(r,{skip:!r}),A=()=>{const a=R.find(o=>o._id===r);v(o=>{if(a){let f=a?.qty+o||o;return m&&f<=m.countInStock?(w(F({...a??m,qty:f})),j("/")):(f=o,h(!0)),f}else m&&(w(F({...m,qty:o})),j("/"));return o})},O=async a=>{d(a.target.value)},B=async a=>{if(a.preventDefault(),l.trim()===""){alert("Please enter a comment");return}if(!y){N.warning("Please log in to submit a review"),j("/login?redirect=/product/"+r);return}if(!r){N.error("Product not found");return}try{await b({productId:r,review:{comment:l,rating:s}}).unwrap(),N.success("Review submitted successfully"),d(""),i(0)}catch(o){N.error("Failed to submit review. Please fill all fields."),console.error("Failed to submit review:",o)}};g.useEffect(()=>{if(p){const a=setTimeout(()=>h(!1),1e3);return()=>clearTimeout(a)}},[p]);const U={product:m,qty:x,setQty:v,addToCartHandler:A,reviews:I,loadingReviews:t,userInfo:y,rating:s,setRating:i,comment:l,handleCommentChange:O,commentSubmitHandler:B,loadingReviewCreate:L,errorReviewCreate:C,productLoading:G,productLoadingError:M,showMessage:p};return e.jsx(te,{...U})};export{ne as default};

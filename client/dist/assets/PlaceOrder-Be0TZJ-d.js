import{g,u,i as y,r as I,j as s,C as h,b as i,d as t,M as l,I as f,L as P,e as A,B as C,c as b,bM as M,bN as N,y as m}from"./index-BR7e0FAz.js";import{u as O}from"./ordersApiSlice-D_qTd9uo.js";import{C as S}from"./CheckoutStepper-EE2rjixp.js";import{L as n}from"./ListGroup-CPytsWHT.js";const L=()=>{const d=g(),c=u(),e=y(r=>r.cart),[x,{isLoading:o,error:a}]=O();I.useEffect(()=>{!e.shippingAddress||Object.keys(e.shippingAddress).length===0?d("/shipping"):e.paymentMethod||d("/payment")},[e.shippingAddress,e.paymentMethod,d]);const j=async()=>{try{const r=await x({orderItems:e.cartItems,shippingAddress:e.shippingAddress,paymentMethod:e.paymentMethod,itemsPrice:e.itemsPrice,shippingPrice:e.shippingPrice,taxPrice:e.taxPrice,totalPrice:e.totalPrice}).unwrap();d(`/order/${r._id}`),c(M(r)),c(N())}catch(r){r?.data?m.error(r?.data?.message||"Something went wrong"):m.error(r?.message||"Something went wrong")}};return s.jsxs(s.Fragment,{children:[s.jsx(h,{children:s.jsx(i,{className:"justify-content-md-center",children:s.jsx(t,{xs:12,md:6,children:s.jsx("div",{className:"p-4 rounded-4 mt-1 mt-md-5",style:{maxWidth:600,background:"#f1f5f9",width:"100%",margin:"auto"},children:s.jsx(S,{activeStep:2})})})})}),s.jsx(h,{children:s.jsxs(i,{children:[s.jsx(t,{xs:10,md:8,className:"mx-auto mt-2 mt-md-4 mb-4",children:s.jsxs(n,{variant:"flush",className:"border rounded-2",children:[s.jsxs(n.Item,{children:[s.jsx("h2",{children:"Shipping"}),s.jsxs("p",{children:[s.jsx("strong",{children:"Address:"}),e.shippingAddress&&s.jsxs(s.Fragment,{children:[s.jsxs("span",{children:[e.shippingAddress.address,", "]}),s.jsxs("span",{children:[e.shippingAddress.city,", "]}),s.jsxs("span",{children:[e.shippingAddress.postalCode,", "]}),s.jsx("span",{children:e.shippingAddress.country})]})]})]}),s.jsxs(n.Item,{children:[s.jsx("h2",{children:"Payment Method"}),s.jsx("strong",{children:"Method: "}),e.paymentMethod]}),s.jsxs(n.Item,{children:[s.jsx("h2",{children:"Order Items"}),e.cartItems.length===0?s.jsx(l,{children:"Your Cart is empty"}):s.jsx(n,{variant:"flush",children:e.cartItems.map((r,p)=>s.jsx(n.Item,{children:s.jsxs(i,{children:[s.jsx(t,{md:1,children:s.jsx(f,{src:r.image,alt:r.name,fluid:!0,rounded:!0})}),s.jsx(t,{className:"mt-2 mt-md-0",children:s.jsx("strong",{children:s.jsx(P,{to:`/product/${r._id}`,children:r.name})})}),s.jsxs(t,{md:4,className:"mt-2 mt-md-0",children:[r.qty," x $",r.price," =",s.jsxs("strong",{children:[" ","$",(r.qty*r.price).toFixed(2)]})]})]})},p))})]})]})}),s.jsx(t,{xs:10,md:4,className:"mx-auto mt-0 mt-md-4",children:s.jsx(A,{children:s.jsxs(n,{variant:"flush",children:[s.jsx(n.Item,{children:s.jsx("h2",{children:"Order Summary"})}),s.jsx(n.Item,{children:s.jsxs(i,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Items:"})}),s.jsxs(t,{children:["$",e.itemsPrice]})]})}),s.jsx(n.Item,{children:s.jsxs(i,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Shipping:"})}),s.jsxs(t,{children:["$",e.shippingPrice]})]})}),s.jsx(n.Item,{children:s.jsxs(i,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Tax:"})}),s.jsxs(t,{children:["$",e.taxPrice]})]})}),s.jsx(n.Item,{children:s.jsxs(i,{children:[s.jsx(t,{children:s.jsx("strong",{children:"Total:"})}),s.jsxs(t,{children:["$",e.totalPrice]})]})}),a&&s.jsx(n.Item,{children:s.jsx(l,{variant:"danger",children:"status"in a?JSON.stringify(a.data):a?.message||"An error occurred"})}),s.jsxs(n.Item,{children:[s.jsx(C,{type:"button",className:"btn-block",disabled:e.cartItems.length===0,onClick:j,children:"Place Order"}),o&&s.jsx(b,{})]})]})})})]})})]})};export{L as default};
